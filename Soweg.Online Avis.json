{"files":[{"id":"d4f3fe8d-a5d3-4c30-91a5-01b9f741763a","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Africa/Algiers\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"2159730b-4e85-4c1e-88d9-d730b10a260b","name":"Code","type":"server_js","source":"function doPost(e) {\n  try {\n    const data \u003d JSON.parse(e.postData.contents);\n    if (!data.avis) return ContentService.createTextOutput(\"Aucune donnée d\u0027avis reçue\");\n\n    const avis \u003d data.avis;\n\n    const ss \u003d SpreadsheetApp.openById(\"1eNyhDufaTAj-o2b_d3gUGsYatT28B4WtVLe3Ab-EJ2k\"); // \u003c-- à modifier\n    const sh \u003d ss.getSheetByName(\"Avis\");\n\n    if (!sh) throw new Error(\"Onglet \u0027Avis\u0027 introuvable\");\n\n    sh.appendRow([\n      new Date(),\n      avis.article,\n      avis.nom,\n      avis.note,\n      avis.commentaire\n    ]);\n\n    return ContentService.createTextOutput(\"OK\");\n  } catch (err) {\n    return ContentService.createTextOutput(\"Erreur : \" + err.message);\n  }\n}\n\nfunction doGet(e) {\n  try {\n    const articleCode \u003d e.parameter.article;\n    if (!articleCode) {\n      return ContentService.createTextOutput(JSON.stringify({ error: \"Code article manquant\" }))\n        .setMimeType(ContentService.MimeType.JSON);\n    }\n\n    const ss \u003d SpreadsheetApp.openById(\"1eNyhDufaTAj-o2b_d3gUGsYatT28B4WtVLe3Ab-EJ2k\"); // même ID\n    const sh \u003d ss.getSheetByName(\"Avis\");\n    const data \u003d sh.getDataRange().getValues();\n    const header \u003d data.shift();\n\n    const avisFiltres \u003d data\n      .filter(r \u003d\u003e r[1] \u003d\u003d\u003d articleCode)\n      .map(r \u003d\u003e ({\n        date: Utilities.formatDate(new Date(r[0]), \"Africa/Algiers\", \"dd/MM/yyyy HH:mm\"),\n        nom: r[2],\n        note: r[3],\n        commentaire: r[4]\n      }));\n\n    return ContentService.createTextOutput(JSON.stringify(avisFiltres))\n      .setMimeType(ContentService.MimeType.JSON);\n  } catch (err) {\n    return ContentService.createTextOutput(JSON.stringify({ error: err.message }))\n      .setMimeType(ContentService.MimeType.JSON);\n  }\n}"}]}